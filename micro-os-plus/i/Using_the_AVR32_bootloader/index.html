<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Using the AVR32 bootloader</title>
  <meta name="description" content="The third edition of µOS++ and CMSIS++, a proposal for the next generation CMSIS, written in C++.">

  <meta property="og:title" content="Using the AVR32 bootloader">
  <meta property="og:site_name" content="µOS++ IIIe / CMSIS++">

  <link rel="alternate" type="application/rss+xml" title="µOS++ IIIe / CMSIS++" href="/feed.xml">


  <meta property="article:published_time" content="2011-07-22">





  <meta name="google-site-verification" content="NT_y3tqI_8mrd8gYA_FDWHT2-tkJExOC6KBkSnyZx6c">

  <link href="https://fonts.googleapis.com/css?family=Architects+Daughter" rel="stylesheet" type="text/css">

  <link rel="stylesheet" type="text/css" href="/stylesheets/screen.css?201603032012" media="screen">
  <link rel="stylesheet" type="text/css" href="/stylesheets/print.css?201603032012" media="print">

  <link rel="canonical" href="http://micro-os-plus.github.io/micro-os-plus/i/Using_the_AVR32_bootloader/">



  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-16767008-14', 'auto');
  ga('send', 'pageview');

</script>



</head>


<body>

<div class="container">

  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.4";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

  <script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>

  <div class="site-header">
  <table style="width:100%">
    <tr>
      <td>
        <a href="/">
          <img class="site-icon" src="/assets/icons/wall-e-icon.png" height="100" width="100">
      </a>
      </td>
      <td>
        <table class="site-title" style="width:100%">
          <tr>
            <td class="site-title">
              <a href="/">µOS++ IIIe / CMSIS++</a>
            </td>
            <td class="site-motto" align="right">
              “Perfekt ist nicht gut genug”
            </td>
          </tr>
          <tr>
            <td class="site-description" colspan="2">
              The third edition of µOS++ and CMSIS++, a proposal for the next generation CMSIS, written in C++.
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</div>


</div>

<div class="container">

  <div class="wrapper">
    <div class="site-body">

      <div class="site-sidebar">


  <div class="custom-sidebar">
    <div class="boxed-group-inner">
      <h4 id="newsblog"><a href="/blog/">News</a></h4>

<ul>
  <li><a href="/blog/2016/03/29/license-update/">License changed from LGPL to MIT License</a></li>
  <li><a href="/blog/2016/03/10/arm-connected-community-article/">ARM Connected Community article, March 11, 2016</a></li>
  <li><a href="/blog/2016/03/03/web-new-look/">The µOS++ IIIe new web site (using GitHub Pages)</a></li>
</ul>


    </div>
  </div>


  <div class="custom-sidebar">
    <div class="boxed-group-inner">
      <h4 id="home"><a href="/">Home</a></h4>

<h4 id="os-iiie">µOS++ IIIe</h4>

<ul>
  <li><a href="/micro-os-plus/">Overview</a></li>
</ul>

<h4 id="cmsis">CMSIS++</h4>

<ul>
  <li><a href="/cmsis-plus/">Overview</a></li>
  <li><a href="/cmsis-plus/rtos/">RTOS API</a></li>
</ul>

<h4 id="xpacksxcdl">xPacks/XCDL</h4>

<ul>
  <li><a href="/xpacks/">Overview</a></li>
</ul>

<h4 id="documentation">Documentation</h4>

<ul>
  <li><a href="/user-manual/">User’s manual</a></li>
  <li><a href="/reference/cmsis-plus/">CMSIS++ reference</a></li>
</ul>

<h4 id="developer">Developer</h4>

<ul>
  <li><a href="/develop/">Overview</a></li>
  <li><a href="/develop/coding-style/">C++ coding style</a></li>
  <li><a href="/develop/references/">Links &amp; references</a></li>
</ul>

<h4 id="support">Support</h4>

<ul>
  <li><a href="/support/">Overview</a></li>
  <li><a href="/support/known-issues/">Known issues</a></li>
  <li><a href="/support/faq/">FAQ</a></li>
  <li><a href="/support/forum/">Forum</a></li>
  <li><a href="https://github.com/micro-os-plus/cmsis-plus/issues/">Report CMSIS++ issues</a></li>
  <li><a href="https://github.com/micro-os-plus/micro-os-plus-iii/issues/">Report µOS++ IIIe issues</a></li>
</ul>

<h4 id="latest-articles">Latest Articles</h4>

<ul>
  <li><a href="/articles/arm-com-2016-06-24/">CMSIS++ RTOS: fully functional reference implementation</a></li>
  <li><a href="/articles/arm-com-2016-03-11/">CMSIS++: a proposal for a future CMSIS, written in C++</a></li>
</ul>

<h4 id="license">License</h4>

<ul>
  <li><a href="https://opensource.org/licenses/MIT">MIT</a></li>
</ul>

<h4 id="aboutabout"><a href="/about/">About</a></h4>

    </div>
  </div>

  <div class="site-theme">
    This site uses the <a href="https://github.com/ilg-ul/github-jekyll-theme">GitHub Wiki-like</a> theme by <a href="https://github.com/ilg-ul">Liviu Ionescu</a>.
  </div>

</div>


      <div class="site-content">

        
<h1 class="page-title">Using the AVR32 bootloader - DEPRECATED</h1>
<p class="last-modified">Page date Fri Jul 22 13:08:39 2011 UTC.</p>


<div id="toc-container">
<table class="toc" id="toc">
<tbody>
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toc_level-1 toc_section-1">
<a href="#erase-the-chip"><span class="tocnumber">1</span> <span class="toctext">Erase the chip</span></a>
</li>
<li class="toc_level-1 toc_section-2">
<a href="#program-the-bootloader-code"><span class="tocnumber">2</span> <span class="toctext">Program the bootloader code</span></a>
</li>
<li class="toc_level-1 toc_section-3">
<a href="#configure-the-usb-dfu-programmer"><span class="tocnumber">3</span> <span class="toctext">Configure the USB DFU programmer</span></a>
</li>
<li class="toc_level-1 toc_section-4">
<a href="#program-flash-image"><span class="tocnumber">4</span> <span class="toctext">Program flash image</span></a>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<p>Atmel provides a functional bootloader for its UC3 processors. It was intended for reprogramming the firmware after deployment, but it can be also used during development, as a more convenient alternative to JTAG.</p>

<h1 id="how-to-program-the-bootloader">How to program the bootloader</h1>

<p>The bootloader occupies the first 8 KB of the flash space, and should be programmed using the JTAG.</p>

<p>The Atmel tools to manage chip programming are available in the AVR perspective:</p>

<ul>
  <li>select the <strong>AVR</strong> perspective:
    <ul>
      <li>
<strong>Eclipse</strong> menu: <strong>Windows</strong> → <strong>Open perspective</strong> → <strong>Other</strong>
</li>
      <li>select <strong>AVR</strong>
</li>
      <li>click the <strong>OK</strong> button</li>
    </ul>
  </li>
</ul>

<h2 id="erase-the-chip">Erase the chip</h2>

<p>Although it seems to be included in the next step, to avoid any surprises, it is recommended to first completely erase the chip before any programming.</p>

<p>Be sure you select <strong>Chip Erase…</strong>, not just <strong>Erase…</strong>, to completely erase the chip, including any security bits.</p>

<ul>
  <li>in the <strong>AVR Targets</strong> tab, right-click on <strong>JTABICE mkII</strong>
</li>
  <li>click on <strong>Chip Erase…</strong>
    <ul>
      <li>read the notificaton message and click the <strong>OK</strong> button</li>
    </ul>
  </li>
</ul>

<p>For reference, on my machine this translated to:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>cmd.exe /C avr32program -c USB:0700000053E7 -pjtagicemkii --gui --part UC3A3256 chiperase
</code></pre>
</div>

<h2 id="program-the-bootloader-code">Program the bootloader code</h2>

<ul>
  <li>in the <strong>AVR Targets</strong> tab, right-click on <strong>JTAGICE mkII</strong>
</li>
  <li>click on <strong>Program Bootloadewr…</strong>
    <ul>
      <li>select the part, the <strong>USB DFU</strong> type and the latest version (currently 1.0.3)</li>
      <li>click the <strong>Next</strong> button</li>
      <li>in the AT32UC3 Bootloader wizard page
        <ul>
          <li>set the pin to <strong>42</strong> (or any other value your board supports); this is the pin where the booloader button is connected.</li>
          <li>deselect the level (the User Page Configuration Word should read 0x929E2A9E)</li>
          <li>select all 3 bit configurations: ISP_BOD_EN, ISP_IO_COND_EN, ISP_FORCE (the FuseBitConfiguration Value should read 0xFFF7FFFF)</li>
          <li>click on the <strong>Finish</strong> button</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>For reference, on my machine this translated to:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>cmd.exe /C avr32program -c USB:0700000053E7 -pjtagicemkii --part UC3A3256 chiperase
cmd.exe /C avr32program -c USB:0700000053E7 -pjtagicemkii --part UC3A3256 program
  -finternal@0x80000000,512Kb -cxtal -e -v -O0x80000000 -Fbin
  C:\Users\LIVIUI~1\AppData\Local\Temp\at32uc3a3-isp-1.0.3.bin9020454716059643611.bin
cmd.exe /C avr32program -c USB:0700000053E7 -pjtagicemkii --part UC3A3256 program
  -finternal@0x80000000,512Kb -cxtal -e -v -O0x808001FC -Fbin
  C:\Users\LIVIUI~1\AppData\Local\Temp\userConf7033399909011047483,dat
cmd.exe /C avr32program -c USB:0700000053E7 -pjtagicemkii --part UC3A3256 writefuses
  -finternal@0x80000000,512Kb gp=0xfff7ffff
cmd.exe /C avr32program -c USB:0700000053E7 -pjtagicemkii --part UC3A3256 reset
cmd.exe /C avr32program -c USB:0700000053E7 -pjtagicemkii --part UC3A3256 run
</code></pre>
</div>

<h1 id="how-to-use-the-bootloader">How to use the bootloader</h1>

<h2 id="configure-the-usb-dfu-programmer">Configure the USB DFU programmer</h2>

<p>Configuring the USB DFU Programmer is certainly possible, but unfortunately it is not obvious, probably due to some bugs.</p>

<p>The first step is to add a new AVR Target. In the properties page, the Details tab, should allow to select the</p>

<ul>
  <li>Device: AT32UC3A3256 (or some other value to match your board)</li>
  <li>Debugger/programmer: USB DFU</li>
  <li>Clock source: External clock connected to OSC0 (or some other value to match your board)</li>
</ul>

<p>If these selections are not available, the trick is to play with existing config until they become available. For example you can first configure the JTAGICE mkII first and select the Device.</p>

<h2 id="program-flash-image">Program flash image</h2>

<ul>
  <li>in the <strong>AVR Targets</strong> tab, right-click on USB DFU
    <ul>
      <li>click the <strong>Program…</strong> menu item</li>
      <li>select the file path to the .elf image</li>
      <li>leave the offset to <strong>0x0</strong>
</li>
      <li>set the following options
        <ul>
          <li>enable <strong>Verify memory after programming</strong>
</li>
          <li>enable <strong>Erase flash before programming</strong>
</li>
          <li>enable <strong>Unlock flash before erasing</strong>
</li>
          <li>disable <strong>Reset MCU after programming</strong>
</li>
          <li>enable <strong>Start executing after programming</strong>
</li>
        </ul>
      </li>
      <li>click the <strong>OK</strong> button</li>
    </ul>
  </li>
</ul>

<p>The device will start to execute the new image as soon as programming is completed.</p>








<ul class="share-buttons">
  <li><div class="fb-share-button" data-href="http://micro-os-plus.github.io/micro-os-plus/i/Using_the_AVR32_bootloader/" data-layout="button"></div></li>
  <li><div class="tw-share-button"><a href="https://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a></div></li>
</ul>



      </div>

    </div>
  </div>

</div>

<div class="container">

  <div class="site-footer">
  <div class="site-footer-links left">
    <ul>
  <li>© 2016 Liviu Ionescu</li>
  <li>Hosted on GitHub</li>
  <li><a href="/feed.xml"><img src="/assets/images/feed-20.png" alt="RSS"></a></li>
</ul>


  </div>
  <a href="https://github.com/micro-os-plus/cmsis-plus" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
  </a>
  <div class="site-footer-links right">
    <ul>
  <li><a href="/">Home</a></li>
  <li><a href="/blog/">News</a></li>
  <li><a href="https://github.com/micro-os-plus/cmsis-plus/releases">Releases</a></li>
  <li><a href="https://github.com/micro-os-plus/cmsis-plus/issues">Support</a></li>
  <li><a href="/about/">About</a></li>
</ul>

  </div>
</div>


</div>

</body>
</html>
